# ZooKeeper 选举 leader 节点的算法

1. 选举时节点有两种状态

- LOOKING
- LEADER/FOLLOWER

2. 选举原则

- 首先选自己
- SID(节点ID)越大越优先, 所处理的事务 zxid 越新越优先

3. 以 N 个节点选举主节点为例

    1. 选取自己作为候选人, 当前状态: LOOKING
    2. 广播给其它 N - 1 个节点
    3. 获取其它节点的候选人, 从中选取 SID 最大的, 或者是 zxid 最新的, 作为候选人
    4. 将自己的新候选人再次广播给其它 N - 1 个节点
    5. 直到过半数节点的候选人相同, 将该候选人作为 leader, 状态置为 follower
    6. 一段时间后若候选人不变, 确定该节点为 leader
